---
title: "test"
author: "pss"
date: "October 31, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rstan); 
library(dplyr); 
library(ggplot2); 
options(mc.cores = parallel::detectCores())

set.seed(49)
```

```{r}

# Observations
N <- 2000

# Draw errors
rho <- 0.5
Sigma <- matrix(c(1, rho, rho, 1), 2, 2)
errors <- MASS::mvrnorm(N, c(0, 0), Sigma)

# Draw some fake covariates
P <- 5
P2 <- 3
X <- cbind(1, matrix(rnorm((P-1)*N), N, P-1))
Z <- matrix(rnorm(P2*N), N, P2)

# Some fake parameters
beta <- rnorm(P + P2)
gamma <- rnorm(P + 1)

# Make Y
Ystar1 <- cbind(X, Z) %*% beta + errors[,1]
Y1 = as.numeric(Ystar1 > 0 )

# Make covariates for second stage
X2 <- cbind(Y1, X)

# Make outcome
Ystar2 <- X2 %*% gamma + errors[,2]
Y2 <- as.numeric(Ystar2 > 0)

# Create data
Y <- cbind(Y1, Y2)
cor(Y)

```

